"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_q2=self.webpackChunkphysical_ai_humanoid_robotics_q2||[]).push([[2496],{102(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"chapters/gazebo-simulation","title":"Chapter 5 \u2014 Gazebo Simulation (Classic) + Diff Drive","description":"Learning Objectives","source":"@site/docs/chapters/05-gazebo-simulation.md","sourceDirName":"chapters","slug":"/chapters/gazebo-simulation","permalink":"/hackathon1/chapters/gazebo-simulation","draft":false,"unlisted":false,"editUrl":"https://github.com/mohammadfaisalpirzada/hackathon1/edit/main/docs/chapters/05-gazebo-simulation.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Chapter 5 \u2014 Gazebo Simulation (Classic) + Diff Drive"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 4 \u2014 URDF/Xacro + TF2 (Robot Model and Frames)","permalink":"/hackathon1/chapters/urdf-tf2"},"next":{"title":"Chapter 6 \u2014 Unity Simulation (ROS-TCP-Connector Pattern)","permalink":"/hackathon1/chapters/unity-simulation"}}');var o=i(4848),a=i(8453);const r={title:"Chapter 5 \u2014 Gazebo Simulation (Classic) + Diff Drive"},t="Chapter 5 - Gazebo Simulation (Classic) + Diff Drive",l={},d=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Key Terms",id:"key-terms",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Concepts",id:"concepts",level:2},{value:"Why simulate early",id:"why-simulate-early",level:3},{value:"URDF + Gazebo plugins (what\u2019s really happening)",id:"urdf--gazebo-plugins-whats-really-happening",level:3},{value:"Hands-on Lab: spawn minibot in Gazebo and drive it with <code>/cmd_vel</code>",id:"hands-on-lab-spawn-minibot-in-gazebo-and-drive-it-with-cmd_vel",level:2},{value:"1) Add a Gazebo-ready Xacro",id:"1-add-a-gazebo-ready-xacro",level:3},{value:"2) Add a spawn launch file",id:"2-add-a-spawn-launch-file",level:3},{value:"3) Install the new files",id:"3-install-the-new-files",level:3},{value:"4) Build and run",id:"4-build-and-run",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Quick Quiz",id:"quick-quiz",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"chapter-5---gazebo-simulation-classic--diff-drive",children:"Chapter 5 - Gazebo Simulation (Classic) + Diff Drive"})}),"\n",(0,o.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Explain how Gazebo plugins bridge ROS commands into simulation physics."}),"\n",(0,o.jsxs)(n.li,{children:["Spawn a robot and drive it via ",(0,o.jsx)(n.code,{children:"/cmd_vel"})," while validating ",(0,o.jsx)(n.code,{children:"/odom"})," and sim time."]}),"\n",(0,o.jsx)(n.li,{children:"Diagnose common sim failures (wrong units, inverted wheels, broken TF)."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"key-terms",children:"Key Terms"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Gazebo Classic, plugin, diff drive, ",(0,o.jsx)(n.code,{children:"/cmd_vel"}),", ",(0,o.jsx)(n.code,{children:"/odom"}),", ",(0,o.jsx)(n.code,{children:"use_sim_time"}),", physics engine"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Gazebo Classic integration installed:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install -y ros-humble-gazebo-ros-pkgs\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Completed Chapter 4 (",(0,o.jsx)(n.code,{children:"q2_minibot_description"})," exists)."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"concepts",children:"Concepts"}),"\n",(0,o.jsx)(n.h3,{id:"why-simulate-early",children:"Why simulate early"}),"\n",(0,o.jsx)(n.p,{children:"Simulation catches:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"bad TF trees (frames jumping)"}),"\n",(0,o.jsx)(n.li,{children:"wrong units (meters vs centimeters)"}),"\n",(0,o.jsx)(n.li,{children:"control sign errors (left/right inverted)"}),"\n",(0,o.jsx)(n.li,{children:"missing constraints (robot \u201cteleports\u201d because physics is wrong)"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"urdf--gazebo-plugins-whats-really-happening",children:"URDF + Gazebo plugins (what\u2019s really happening)"}),"\n",(0,o.jsx)(n.p,{children:"Gazebo needs:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"a model (your URDF)"}),"\n",(0,o.jsx)(n.li,{children:"physics properties (friction, inertial sanity)"}),"\n",(0,o.jsx)(n.li,{children:"a control interface (plugin)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"For a simple diff-drive:"}),"\n",(0,o.jsx)(n.mermaid,{value:'flowchart LR\n  Teleop["teleop node"] --\x3e|/cmd_vel| DiffDrivePlugin\n  DiffDrivePlugin --\x3e GazeboPhysics\n  GazeboPhysics --\x3e|/odom + TF| ROS2'}),"\n",(0,o.jsxs)(n.h2,{id:"hands-on-lab-spawn-minibot-in-gazebo-and-drive-it-with-cmd_vel",children:["Hands-on Lab: spawn minibot in Gazebo and drive it with ",(0,o.jsx)(n.code,{children:"/cmd_vel"})]}),"\n",(0,o.jsx)(n.h3,{id:"1-add-a-gazebo-ready-xacro",children:"1) Add a Gazebo-ready Xacro"}),"\n",(0,o.jsx)(n.p,{children:"Create a sim-specific robot description by copying your Chapter 4 file and adding Gazebo tags:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cp ~/q2_ws/src/q2_minibot_description/urdf/minibot.urdf.xacro \\\n  ~/q2_ws/src/q2_minibot_description/urdf/minibot.gazebo.urdf.xacro\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Edit ",(0,o.jsx)(n.code,{children:"~/q2_ws/src/q2_minibot_description/urdf/minibot.gazebo.urdf.xacro"})," and append the following\njust before the closing ",(0,o.jsx)(n.code,{children:"</robot>"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:'  \x3c!-- Simple ground contact tuning --\x3e\n  <gazebo reference="base_link">\n    <mu1>0.8</mu1>\n    <mu2>0.8</mu2>\n  </gazebo>\n\n  \x3c!-- Differential drive plugin --\x3e\n  <gazebo>\n    <plugin name="diff_drive" filename="libgazebo_ros_diff_drive.so">\n      <ros>\n        <namespace>/</namespace>\n      </ros>\n      <left_joint>left_wheel_joint</left_joint>\n      <right_joint>right_wheel_joint</right_joint>\n      <wheel_separation>0.30</wheel_separation>\n      <wheel_diameter>0.10</wheel_diameter>\n      <command_topic>cmd_vel</command_topic>\n      <odometry_topic>odom</odometry_topic>\n      <odometry_frame>odom</odometry_frame>\n      <robot_base_frame>base_link</robot_base_frame>\n      <publish_odom>true</publish_odom>\n      <publish_wheel_tf>true</publish_wheel_tf>\n      <update_rate>50</update_rate>\n    </plugin>\n  </gazebo>\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-add-a-spawn-launch-file",children:"2) Add a spawn launch file"}),"\n",(0,o.jsxs)(n.p,{children:["Create ",(0,o.jsx)(n.code,{children:"~/q2_ws/src/q2_minibot_description/launch/spawn_minibot_gazebo.launch.py"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from launch import LaunchDescription\nfrom launch.actions import IncludeLaunchDescription\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch_ros.actions import Node\nfrom launch.substitutions import Command, PathJoinSubstitution\nfrom launch_ros.substitutions import FindPackageShare\n\n\ndef generate_launch_description():\n    pkg_share = FindPackageShare("q2_minibot_description")\n    xacro_file = PathJoinSubstitution([pkg_share, "urdf", "minibot.gazebo.urdf.xacro"])\n    robot_description = {"robot_description": Command(["xacro ", xacro_file])}\n\n    gazebo_launch = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource(\n            [FindPackageShare("gazebo_ros"), "/launch/gazebo.launch.py"]\n        )\n    )\n\n    return LaunchDescription(\n        [\n            gazebo_launch,\n            Node(\n                package="robot_state_publisher",\n                executable="robot_state_publisher",\n                parameters=[robot_description, {"use_sim_time": True}],\n            ),\n            Node(\n                package="gazebo_ros",\n                executable="spawn_entity.py",\n                arguments=["-topic", "robot_description", "-entity", "minibot"],\n                output="screen",\n            ),\n        ]\n    )\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-install-the-new-files",children:"3) Install the new files"}),"\n",(0,o.jsxs)(n.p,{children:["Edit ",(0,o.jsx)(n.code,{children:"~/q2_ws/src/q2_minibot_description/CMakeLists.txt"})," to ensure ",(0,o.jsx)(n.code,{children:"urdf/"})," and ",(0,o.jsx)(n.code,{children:"launch/"})," are\ninstalled (from Chapter 4)."]}),"\n",(0,o.jsx)(n.h3,{id:"4-build-and-run",children:"4) Build and run"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd ~/q2_ws\ncolcon build --symlink-install\nsource ~/q2_ws/install/setup.bash\nros2 launch q2_minibot_description spawn_minibot_gazebo.launch.py\n"})}),"\n",(0,o.jsx)(n.p,{children:"Drive it:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt install -y ros-humble-teleop-twist-keyboard\nros2 run teleop_twist_keyboard teleop_twist_keyboard\n"})}),"\n",(0,o.jsx)(n.p,{children:"Inspect odometry:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ros2 topic echo /odom --once\nros2 topic list | rg cmd_vel\n\n## Lab Deliverable\n\n- A Gazebo bringup where the robot spawns and responds to `/cmd_vel` and publishes `/odom` without TF/time inconsistencies.\n\n## Assessment Item\n\n- Practical check: demonstrate motion and provide one diagnosis transcript (the commands you ran) for a simulated failure and fix.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Gazebo opens but robot doesn\u2019t spawn","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Check spawn output (the ",(0,o.jsx)(n.code,{children:"spawn_entity.py"})," node prints errors)."]}),"\n",(0,o.jsxs)(n.li,{children:["Verify ",(0,o.jsx)(n.code,{children:"robot_description"})," exists:\n",(0,o.jsx)(n.code,{children:"ros2 param get /robot_state_publisher robot_description | head"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Robot spawns but doesn\u2019t move","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Confirm ",(0,o.jsx)(n.code,{children:"/cmd_vel"})," is published:\n",(0,o.jsx)(n.code,{children:"ros2 topic echo /cmd_vel --once"})]}),"\n",(0,o.jsx)(n.li,{children:"Confirm plugin is loaded (Gazebo console shows plugin errors)."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Robot moves but odom/TF looks wrong","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Your wheel separation/diameter are wrong. Fix ",(0,o.jsx)(n.code,{children:"<wheel_separation>"})," and ",(0,o.jsx)(n.code,{children:"<wheel_diameter>"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"quick-quiz",children:"Quick Quiz"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"What does the diff drive plugin consume, and what does it publish?"}),"\n",(0,o.jsxs)(n.li,{children:["Why do we set ",(0,o.jsx)(n.code,{children:"use_sim_time:=True"})," in simulation nodes?"]}),"\n",(0,o.jsx)(n.li,{children:"Name one common reason a robot \u201cmoves backwards\u201d in sim."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>r,x:()=>t});var s=i(6540);const o={},a=s.createContext(o);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);